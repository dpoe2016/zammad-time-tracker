<!DOCTYPE html>
<html>
<head>
    <title>Check Database</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        pre { background: #2d2d2d; padding: 15px; border-radius: 5px; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
    </style>
</head>
<body>
    <h1>Database Diagnostic</h1>
    <pre id="output">Checking database...</pre>

    <script>
        const output = document.getElementById('output');
        let log = '';
        
        function addLog(msg) {
            log += msg + '\n';
            output.textContent = log;
        }

        // Check all databases
        indexedDB.databases().then(dbs => {
            addLog('=== All IndexedDB Databases ===');
            dbs.forEach(db => addLog(`- ${db.name} (v${db.version})`));
            addLog('');
            
            // Open ZammadTimeTracker
            addLog('=== Opening ZammadTimeTracker ===');
            const request = indexedDB.open('ZammadTimeTracker');
            
            request.onsuccess = function(event) {
                const db = event.target.result;
                addLog(`✅ Database opened successfully`);
                addLog(`Version: ${db.version}`);
                addLog(`\nObject Stores (${db.objectStoreNames.length}):`);
                
                for (let i = 0; i < db.objectStoreNames.length; i++) {
                    const storeName = db.objectStoreNames[i];
                    addLog(`  ${i + 1}. ${storeName}`);
                }
                
                // Check for sprint stores
                const hasSprintStore = db.objectStoreNames.contains('sprints');
                const hasAssignmentStore = db.objectStoreNames.contains('sprintAssignments');
                
                addLog('');
                if (hasSprintStore && hasAssignmentStore) {
                    addLog('✅ Sprint stores FOUND!');
                } else {
                    addLog('❌ Sprint stores MISSING!');
                    if (!hasSprintStore) addLog('  - Missing: sprints');
                    if (!hasAssignmentStore) addLog('  - Missing: sprintAssignments');
                    addLog('\n⚠️  Database needs to be recreated at version 2');
                }
                
                db.close();
            };
            
            request.onerror = function(event) {
                addLog('❌ Error opening database: ' + event.target.error);
            };
        });
    </script>
</body>
</html>
